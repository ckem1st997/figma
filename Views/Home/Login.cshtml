@model figma.Controllers.HomeController.LoginViewModel

@{
    ViewData["Title"] = "Đăng nhập";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var returnUrl = @Context.Request.Query["returnurl"];
}

<div class="row d-flex justify-content-center mt-5">
    <div class="col-md-4">
        <form asp-action="Login" asp-route-returnUrl="@returnUrl">
            @{
                if (TempData["tq"] != null)
                {
                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                        Message: @TempData["tq"]
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                }
            }
            <h2>User Login</h2>
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label asp-for="Username" class="control-label"></label>
                <input asp-for="Username" class="form-control" />
                <span id="validationuser" asp-validation-for="Username" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Password" class="control-label"></label>
                <input type="password" asp-for="Password" class="form-control" />
                <span id="validationpw" asp-validation-for="Password" class="text-danger"></span>
            </div>
            <div class="form-group form-check">
                <label class="form-check-label">
                    <input class="form-check-input" asp-for="Remember" /> @Html.DisplayNameFor(model => model.Remember)
                    <a class="form-check-input"></a>

                </label>
            </div>
            <div class="form-group d-flex justify-content-between">
                <div class="form-group">
                    <a asp-action="PasswordEmail" class="btn btn-default btn-primary">Quên mật khẩu</a>
                </div>
            </div>
            <div class="form-group d-flex justify-content-between">
                <div class="form-group">
                    <input id="Login" type="submit" value="Login" class="btn btn-default btn-primary" />
                </div>
                <div class="form-group">
                    <a asp-action="Register" class="btn btn-default btn-primary">Register</a>
                </div>
            </div>
            <div class="g-signin2" data-onsuccess="onSignIn"></div>
            <a href="#" onclick="signOut();">Sign out</a>
            <a href="/google-login">Login</a>
            <script>
                function signOut() {
                    var auth2 = gapi.auth2.getAuthInstance(); auth2.signOut().then(function () {
                        console.log('User signed out.');
                    });
                }

                function onSignIn(googleUser) {
                    var id_token = googleUser.getAuthResponse().id_token;
                    var profile = googleUser.getBasicProfile();
                    console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
                    console.log('Name: ' + profile.getName());
                    console.log('Image URL: ' + profile.getImageUrl());
                    console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
                    //var xhr = new XMLHttpRequest();
                    //xhr.open('POST', 'https://localhost:44302/signin-google');
                    //xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                    //xhr.onload = function () {
                    //    console.log('Signed in as: ' + xhr.responseText);
                    //};
                    //xhr.send('idtoken=' + id_token);
                    //console.log(id_token);
                    SendToken(id_token);
                }
                function SendToken(token) {
                    console.log(token);
                    var params = {
                        type: 'GET',
                        url: '/Home/GoogleLogin',
                        data: { Token: token },
                        dataType: "json",
                        success: function (res) {
                            console.log(res);
                        },

                        error: function (errormessage) {
                            console.log(errormessage)
                        }


                    };
                    jQuery.ajax(params);
                }
            </script>
        </form>
    </div>
</div>


